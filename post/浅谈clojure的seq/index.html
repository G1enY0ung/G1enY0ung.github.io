<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>g1eny0ung的博客</title>

  
  
  <meta name="author" content="g1eny0ung" />
  <meta name="description" content=" Clojure defines many algorithms in terms of sequences (seqs). A seq is a logical list, and unlike most Lisps where the list is represented by a concrete, 2-slot structure, Clojure uses the ISeq interface to allow many data structures to provide access to their elements as sequences.
 
" />



<meta name="generator" content="Hugo 0.30.2" />


<link rel="canonical" href="https://g1eny0ung.github.io/post/%E6%B5%85%E8%B0%88clojure%E7%9A%84seq/" />
<link rel="alternative" href="/index.xml" title="g1eny0ung的博客" type="application/atom+xml" />

<link href="https://cdn.bootcss.com/semantic-ui/2.2.13/semantic.min.css" rel="stylesheet" >
<link rel="stylesheet" href="/css/site.css">

</head>

<body>
  <div class="flip-container">
    <div class="flipper">
      <section class="front">
        
<nav class="ui top secondary menu">
  <div class="item">
    <i class="inverted big link bullseye icon dream-flip-toggle" title="翻转"></i>
  </div>
  <div class="item">
    <a href="/">
      <i class="inverted big home icon" title="首页"></i>
    </a>
  </div>
</nav>
 
<div class="ui centered grid">
  <div class="fifteen wide mobile eleven wide tablet eleven wide computer column post-list">

    <section class="ui secondary top attached black segment">
      <header>
        <h1 class="ui header">
          浅谈Clojure的seq
          <div class="sub header">@ g1eny0ung · May 13, 2017 · 2 min read · 更新于 May 13, 2017</div>
        </h1>
      </header>
      <article style="margin-top: 2rem; font-size: 1.4rem;"><blockquote>
<p>Clojure defines many algorithms in terms of sequences (seqs). A seq is a logical list, and unlike most Lisps where the list is represented by a concrete, 2-slot structure, Clojure uses the ISeq interface to allow many data structures to provide access to their elements as sequences.</p>
</blockquote>

<p></p>

<p>我们边引用<a href="https://clojure.org/reference/sequences">clojure.org/reference/sequences</a>的介绍，边给出我自己的理解：</p>

<p>clojure中的seqs不像大多数lisp用pair对来实现，clojure使用了ISeq接口使大部分数据结构构建在sequence抽象上，许多的clojure数据结构，像list， map， vector，都可以使用很多序列化操作（我习惯这么称呼：）），像map，first，rest等。</p>

<p>我理解的sequence（seq，下面全用seq），是一种抽象的东西，用这种抽象去实现function来操作一系列的数据抽象。clojure给出了seq function，它可以在collection作为参数下返回seq。e.g.:</p>

<pre><code>(seq '(1 2 3))
;; =&gt; (1 2 3)

(seq [1 2 3])
;; =&gt; (1 2 3)

(seq #{1 2 3})
;; =&gt; (1 2 3)

(seq {:a 1 :b 2 :c 3})
;; =&gt; ([:a 1] [:b 2] [:c 3])
</code></pre>

<p>再看看map function：</p>

<pre><code>(map inc (seq [1 2 3]))
;; =&gt; (2 3 4)

(map inc [1 2 3])
;; =&gt; (2 3 4)
</code></pre>

<p>都是seq对吧，Seq Interface有着三种重要的方法，我们可以看一下ISeq的代码：</p>

<pre><code>public interface ISeq extends IPersistentCollection {

    Object first();

    ISeq next();

    ISeq more();

    ISeq cons(Object o);
}
</code></pre>

<p>先说first和cons，第一个是取出序列的第一个元素，cons是将item和seq组成一个新的seq，item处在第一位。</p>

<p>next和more我们先不管，这两个涉及到一点其他的东西，但是doc中明确指出了还有rest function：</p>

<blockquote>
<p>(rest coll) Returns a sequence of the items after the first. Calls seq on its argument. If there are no more items, returns a logical sequence for which seq returns nil.</p>
</blockquote>

<p>明明没有啊，好，我们再看一下clojure.core/rest的实现：</p>

<pre><code>(def
 ^{:arglists '([coll])
   :tag clojure.lang.ISeq
   :doc &quot;Returns a possibly empty seq of the items after the first. Calls seq on its
  argument.&quot;
   :added &quot;1.0&quot;
   :static true}  
 rest (fn ^:static rest [x] (. clojure.lang.RT (more x))))
</code></pre>

<p>什么！rest其实就是more？那为什么不直接叫rest！</p>

<p>关于这个也让我困扰了很久，我在stackoverflow上发现了一个解释，我觉得可以说明，链接 <a href="http://stackoverflow.com/questions/15815639/why-is-more-of-iseq-not-named-rest">why-is-more-of-iseq-not-named-rest</a></p>

<p>好了，我们不去太多的深究这个问题，我想说的是，别看就只有三种方法，可以用它们实现很多。。很多，多到你想象不到的实用function。</p>

<p>我截取了filter和map的部分代码，如下（后面会有许多额外的括号，忽略）：</p>

<pre><code>;; filter
(let [f (first s) r (rest s)]
          (if (pred f)
            (cons f (filter pred r))
            (filter pred r))))))))
</code></pre>

<p>看，如果f<strong>(first)</strong>满足了pred谓词，就会使用<strong>cons</strong>创建一个新的seq，item就是f，coll是（filter pred r），r就是<strong>rest</strong>,
三个core function完成了filter function</p>

<p>再看map</p>

<pre><code>;; map
(cons (f (first s)) (map f (rest s)))))))
</code></pre>

<p>我觉得这也不需要解释了，十分清晰的操作。</p>

<p>好了，今天就说到这，记住seq这个很强大的抽象还有三个core function，能帮助我们很好的理解clojure中的一些奥秘，通过seq library，也就是一些的seq操作function，让我们更加熟练的掌握clojure的seq哲学。同时我建议也要多读几遍clojure／reference／sequences还有ISeq，LazySeq的代码，会体会的更深。</p>

<p>想理解更多，参考：</p>

<ul>
<li><a href="http://stackoverflow.com/questions/22439174/what-is-the-difference-between-the-functions-seq-sequential-and-coll">what-is-the-difference-between-the-functions-seq-sequential-and-coll</a></li>
<li><a href="https://clojure.org/reference/sequences">Sequences</a></li>
<li><a href="https://clojure.org/reference/lazy">Lazy</a></li>
</ul>

<p>还有一个是关于collection的，我也贴上来</p>

<ul>
<li><a href="http://stackoverflow.com/questions/1147975/in-clojure-when-should-i-use-a-vector-over-a-list-and-the-other-way-around">in-clojure-when-should-i-use-a-vector-over-a-list-and-the-other-way-around</a></li>
</ul></article>
    </section>

    <footer class="ui secondary attached segment dream-tags">
      
      
      <a class="ui label" href="/tags/clojure" title="clojure">clojure</a>
      
      <a class="ui label" href="/tags/tech" title="tech">tech</a>
      
      
    </footer>

    
    <footer class="ui secondary attached segment">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
    </footer>
    

    
    <footer class="ui secondary bottom attached stacked segment">
      <div id="disqus_thread"></div>
      <script>
      

      


      var disqus_config = function () {
      this.page.url = 'https:\/\/g1eny0ung.github.io\/post\/%E6%B5%85%E8%B0%88clojure%E7%9A%84seq\/';  
      this.page.identifier = '\/post\/%E6%B5%85%E8%B0%88clojure%E7%9A%84seq\/'; 
      };

      (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://' + 'g1eny0ung' + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </footer>
    

  </div>
  <div class="fifteen wide mobile four wide tablet four wide computer column">

    <section class="ui top attached center aligned inverted segment">
  <div class="ui small circular image">
    <img src="/me/yy.jpg">
  </div>
  <h3 class="ui header">g1eny0ung的博客<div class="sub header" style="color: white;">In My Head.</div>
  </h3>
  <a id="tag-category-pop" class="ui red right corner label">
    <i class="pointing down icon" title="点击弹出标签和分类"></i>
  </a>
</section>


<section class="ui attached center aligned inverted segment dream-tags">
  
  <a class="ui label" href="/tags/clojure" title="clojure">clojure</a>
  
  <a class="ui label" href="/tags/javascript" title="javascript">javascript</a>
  
  <a class="ui label" href="/tags/petal" title="petal">petal</a>
  
  <a class="ui label" href="/tags/tech" title="tech">tech</a>
  
  <a class="ui label" href="/tags/%E5%B9%B4%E5%BA%A6" title="年度">年度</a>
  
  <a class="ui label" href="/tags/%E7%94%9F%E6%B4%BB" title="生活">生活</a>
  
</section>



<section class="ui attached inverted segment dream-categories">
  <div class="ui inverted accordion">
    
    <div class="title">
      <i class="dropdown icon"></i>
      <a href="/categories/%E6%8A%80%E6%9C%AF" class="item" style="color: white;">技术</a>
    </div>
    <div class="content">
      <div class="ui link inverted list">
      
      <div class="item" style="padding-left: 24px;">
        <i class="cocktail icon"></i>
        <div class="content">
          <a href="https://g1eny0ung.github.io/post/church-encoding/" class="item">Church Encoding</a>
        </div>
      </div>
      
      <div class="item" style="padding-left: 24px;">
        <i class="cocktail icon"></i>
        <div class="content">
          <a href="https://g1eny0ung.github.io/post/%E6%B5%85%E8%B0%88clojure%E7%9A%84seq/" class="item">浅谈Clojure的seq</a>
        </div>
      </div>
      
      </div>
    </div>
    
    <div class="title">
      <i class="dropdown icon"></i>
      <a href="/categories/%E7%BB%99%E8%87%AA%E5%B7%B1%E7%9A%84%E6%80%BB%E7%BB%93" class="item" style="color: white;">给自己的总结</a>
    </div>
    <div class="content">
      <div class="ui link inverted list">
      
      <div class="item" style="padding-left: 24px;">
        <i class="cocktail icon"></i>
        <div class="content">
          <a href="https://g1eny0ung.github.io/post/2016%E5%B9%B4%E7%9A%84%E6%80%BB%E7%BB%93/" class="item">2016年的总结</a>
        </div>
      </div>
      
      </div>
    </div>
    
    <div class="title">
      <i class="dropdown icon"></i>
      <a href="/categories/%E8%AF%AD%E8%A8%80" class="item" style="color: white;">语言</a>
    </div>
    <div class="content">
      <div class="ui link inverted list">
      
      <div class="item" style="padding-left: 24px;">
        <i class="cocktail icon"></i>
        <div class="content">
          <a href="https://g1eny0ung.github.io/post/church-encoding/" class="item">Church Encoding</a>
        </div>
      </div>
      
      <div class="item" style="padding-left: 24px;">
        <i class="cocktail icon"></i>
        <div class="content">
          <a href="https://g1eny0ung.github.io/post/%E6%B5%85%E8%B0%88clojure%E7%9A%84seq/" class="item">浅谈Clojure的seq</a>
        </div>
      </div>
      
      </div>
    </div>
    
    <div class="title">
      <i class="dropdown icon"></i>
      <a href="/categories/%E9%A1%B9%E7%9B%AE" class="item" style="color: white;">项目</a>
    </div>
    <div class="content">
      <div class="ui link inverted list">
      
      <div class="item" style="padding-left: 24px;">
        <i class="cocktail icon"></i>
        <div class="content">
          <a href="https://g1eny0ung.github.io/post/petal%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0/" class="item">Petal版本更新</a>
        </div>
      </div>
      
      </div>
    </div>
    
  </div>
</section>


<section class="ui bottom attached center aligned inverted segment">
    <p>© 2017 g1eny0ung的博客</p>
    <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</p>
</section>

  </div>
</div>

      </section>
      <section class="back">
        <nav class="ui top secondary menu" style="overflow: scroll">
  <div class="item">
    <i class="inverted big link bullseye icon dream-flip-toggle" title="翻转"></i>
  </div>
  
  <div class="item">
    <a href="mailto:g1enyy0ung@gmail.com">
      <i class="inverted big mail icon" title="email"></i>
    </a>
  </div>
  
  
  <div class="item">
    <a href="https://github.com/g1eny0ung" target="_blank">
      <i class="inverted big github icon" title="github"></i>
    </a>
  </div>
  
  
  <div class="item">
    <a href="https://www.linkedin.com/in/%e9%92%ba-%e6%9d%a8-300749117" target="_blank">
      <i class="inverted big linkedin icon" title="linkedin"></i>
    </a>
  </div>
  
  
  <div class="item">
    <a href="https://www.stackoverflow.com/users/5676489/g1eny0ung" target="_blank">
      <i class="inverted big stack overflow icon" title="stackoverflow"></i>
    </a>
  </div>
  
  
  <div class="item">
    <a href="https://codepen.io/g1eny0ung" target="_blank">
      <i class="inverted big codepen icon" title="codepen"></i>
    </a>
  </div>
  
</nav>

<div class="ui centered grid">
  <div class="fifteen wide mobile fifteen wide tablet fifteen wide computer column">

    <section class="ui stacked segments about">
      <header class="ui inverted segment">
        <h2 class="ui header">关于我</h2>
      </header>

      <article class="ui inverted segment">
        
          <p>g1eny0ung的小站</p>
        
          <p>记录一些生活上，技术上的事</p>
        
          <p>一名大四学生</p>
        
          <p>马上毕业于大连东软信息学院</p>
        
          <p>职业是前端工程师</p>
        
          <p>目前在<a href='http://deepglint.com' target='_blank'>格灵深瞳</a>工作</p>
        
          <p>-- 2017年11月11日更新</p>
        
      </article>

      
      <footer class="ui secondary segment">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
      </footer>
      

      
      <footer class="ui secondary segment">
        <div id="disqus_thread"></div>
        <script>
        

        


        var disqus_config = function () {
        this.page.url = 'https:\/\/g1eny0ung.github.io\/post\/%E6%B5%85%E8%B0%88clojure%E7%9A%84seq\//about';  
        this.page.identifier = '/about'; 
        };

        (function() { 
        var d = document, s = d.createElement('script');
        s.src = 'https://' + 'g1eny0ung' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </footer>
      
    </section>

  </div>
</div>

      </section>
    </div>
  </div>

  
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/semantic-ui/2.2.13/semantic.min.js"></script>
<script src="/js/bg.js"></script>
<script src="/js/site.js"></script>



<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-98295641-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


</body>

</html>